function smpInitialise(){smpInitialiseNav();$("ul.smp-planner-list").sortable({handle:".smp-planner-list-meal-drag-handle",isValidTarget:function(n,t){return t.el[0].className.includes("smp-planner-list-meal")},onDrop:function(n,t,i,r){i(n,t,r);let u=n.attr("data-meal"),f=n.parent("ul").attr("data-day");if(typeof u!="undefined"&&typeof f!="undefined"){let t=parseInt(n.prev("li").attr("data-meal"));$.ajax({url:"/api/planner/"+u+"/move",type:"PUT",data:JSON.stringify({date:f,sortOrderPreviousPlannerMealId:t==NaN?null:t}),contentType:"application/json; charset=utf-8",dataType:"json"});return}let e=n.attr("data-shoppinglistitem");if(typeof e!="undefined"){let t=parseInt(n.prev("li").attr("data-shoppinglistitem"));$.ajax({url:"/api/shoppinglist/"+e+"/move",type:"PUT",data:JSON.stringify({sortOrderPreviousShoppingListItemId:t==NaN?null:t}),contentType:"application/json; charset=utf-8",dataType:"json"});return}}});$(".smp-planner-list-meal-oc").click(function(){$(this).parent("div").next().find(".smp-planner-list-meal-details").toggle()});$(".smp-planner-add-header > span").click(function(){if(!$(this).hasClass("selected")){$(this).parent().children("span.selected").each(function(){$(this).removeClass("selected");let n=$(this).attr("data-select");$(n).hide()});$(this).addClass("selected");let n=$(this).attr("data-select");$(n).show()}});$("button[data-depends]").prop("disabled",!0).each(function(){let n=$(this),t=$(n.attr("data-depends"));t.on("keypress",function(t){if(n.attr("disabled")&&(t.keyCode||t.which)===13)return t.preventDefault(),!1});t.on("change input paste keyup",function(){let t=$(this).val();n.prop("disabled",t===null||t.match(/^\s*$/)!==null)})});$("textarea.notes").on("change input paste keyup",function(){let n=$(this).val();if(n!==$(this).data("saved-value")){$("div.note-info").text("Saving...").addClass("note-unsaved");let t=$(this).data("throttle");typeof t!="undefined"&&clearTimeout(t);$(this).data("throttle",setTimeout(function(){$.ajax({url:"/api/note",type:"PUT",data:JSON.stringify({noteText:n}),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(){$("textarea.notes").data("saved-value",n);$("div.note-info").text("Up to date").removeClass("note-unsaved")}).fail(function(){$("div.note-info").text("Error saving note!")})},1e3))}});$("form[data-confirm]").submit(function(n){if(!confirm($(this).attr("data-confirm")))return n.preventDefault(),!1})}function smpInitialiseNav(){$(window).resize(function(){$("aside").css("display","");$(".nav-close:visible").length>0&&($(".nav-close").css("display",""),$(".nav-show").css("display",""))});$(".nav-show").click(function(){$("aside").fadeToggle("fast");$(this).hide();$(".nav-close").show()});$(".nav-close").click(function(){$("aside").hide();$(this).hide();$(".nav-show").show()});$("[data-href]").click(function(){window.location.href=$(this).attr("data-href")})}